{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"SOC Playbooks","text":"<p>This site contains a number of playbooks to assist analysts with maintaining a consistent approach when responding to incidents.</p>"},{"location":"Defender%20for%20Endpoint/mde-client-analyzer/","title":"MDE Client Analyzer","text":""},{"location":"Defender%20for%20Endpoint/mde-client-analyzer/#stable","title":"Stable","text":"<p>The stable MDE Client Analyzer can be downloaded from the following URL:</p> <p>https://aka.ms/mdatpanalyzer</p>"},{"location":"Defender%20for%20Endpoint/mde-client-analyzer/#preview","title":"Preview","text":"<p>The preview MDE Client Analyzer can be downloaded from the following URL:</p> <p>https://aka.ms/betamdatpanalyzer</p>"},{"location":"Defender%20for%20Endpoint/mde-exclusions/","title":"Automatic Exclusions","text":"<p>Automatic Exclusions apply to real-time detections only and do not apply to on-demand scans.</p> <p>These exclusions are described on the following URL:</p> <p>https://learn.microsoft.com/en-us/microsoft-365/security/defender-endpoint/configure-server-exclusions-microsoft-defender-antivirus?view=o365-worldwide</p>"},{"location":"Defender%20for%20Endpoint/mde-exclusions/#scheduled-scans","title":"Scheduled Scans","text":"<p>Exclusions for scheduled scans (full / quick / custom) must be explicitly defined in the AMP policy.</p>"},{"location":"Defender%20for%20Endpoint/mde-exclusions/#sense-edr","title":"Sense EDR","text":"<p>Exclusions for Sense EDR must be defined using Custom Indicators in the Microsoft 365 Defender portal.</p> <p>Due to limitations with Custom Indicators (file hash / domain / IP / cert supported only) a ticket must be raised with Microsoft Support to implement any additional Indicators which are not supported in the portal. Microsoft can then implement these on a per-Tenant basis.</p>"},{"location":"Defender%20for%20Endpoint/mde-updates/","title":"Updating Defender for Endpoint","text":"<p>This document describes how to download and install updates for Microsoft Defender for Endpoint (MDE) components.</p>"},{"location":"Defender%20for%20Endpoint/mde-updates/#engine-and-security-intelligence-updates","title":"Engine and Security Intelligence Updates","text":""},{"location":"Defender%20for%20Endpoint/mde-updates/#kb","title":"KB","text":"<p>KB2267602 - Installed via WSUS / MECM</p>"},{"location":"Defender%20for%20Endpoint/mde-updates/#automatic-updates","title":"Automatic Updates","text":"<p>The MDE Engine and Signature database components are updated automatically every 8 hours, and prior to a scan being performed.</p>"},{"location":"Defender%20for%20Endpoint/mde-updates/#mpcmdrunexe","title":"'MpCmdRun.exe'","text":"<p>Updates can also be installed using 'MpCmdRun.exe' commands.</p> <p>To clear the current cache and trigger an update, run the following commands as an administrator:</p> <pre><code>cd \"C:\\Program Files\\Windows Defender\"\n.\\MpCmdRun.exe -removedefinitions -dynamicsignatures\n.\\MpCmdRun.exe -SignatureUpdate\n</code></pre>"},{"location":"Defender%20for%20Endpoint/mde-updates/#installation-file","title":"Installation File","text":"<p>If there are issues occurring with automatic updates, or those triggered using 'MpCmdRun.exe' commands, you can install Engine / Signature updates using an installation file.</p> <ol> <li> <p>Download the relevant 'mpam-fe.exe' package from:</p> <p>https://www.microsoft.com/en-us/wdsi/defenderupdates</p> </li> <li> <p>Copy the executable to the affected machine and install.</p> </li> </ol>"},{"location":"Defender%20for%20Endpoint/mde-updates/#verify-update-was-successful","title":"Verify update was successful","text":"<ol> <li>Enter the following PowerShell command:</li> </ol> <pre><code>Get-MpComputerStatus\n</code></pre> <ol> <li>Review the output to ensure the following components have been successfully updated:</li> </ol> <pre><code>AMEngineVersion                  : 1.1.19700.3\nAntispywareSignatureVersion      : 1.377.21.0\nAntivirusSignatureVersion        : 1.377.21.0\nNISEngineVersion                 : 1.1.19700.3\nNISSignatureVersion              : 1.377.21.0\n</code></pre>"},{"location":"Defender%20for%20Endpoint/mde-updates/#platform-update","title":"Platform Update","text":""},{"location":"Defender%20for%20Endpoint/mde-updates/#manual-update","title":"Manual update","text":"<p>https://go.microsoft.com/fwlink/?linkid=870379&amp;arch=x64</p>"},{"location":"Defender%20for%20Endpoint/mde-updates/#microsoft-defender-for-endpoint-update-for-edr-sensor-mssense","title":"Microsoft Defender for Endpoint update for EDR Sensor (MsSense)","text":""},{"location":"Defender%20for%20Endpoint/mde-updates/#check-installed-version","title":"Check installed version:","text":"<pre><code>Get-ItemProperty -Path 'Registry::HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows Advanced Threat Protection\\' -Name \"InstallLocation\"\n</code></pre>"},{"location":"Defender%20for%20Endpoint/mde-updates/#kb_1","title":"KB","text":"<p>KB5005292 - Installed as part of cumulative update</p> <p>https://support.microsoft.com/en-us/topic/microsoft-defender-for-endpoint-update-for-edr-sensor-f8f69773-f17f-420f-91f4-a8e5167284ac</p>"},{"location":"Defender%20for%20Endpoint/mde-updates/#manual-update_1","title":"Manual update","text":"<p>https://www.catalog.update.microsoft.com/Search.aspx?q=KB5005292</p>"},{"location":"Email/phishing/","title":"Phishing","text":""},{"location":"Email/phishing/#investigation","title":"Investigation","text":"<p>Collect the following artefacts from the email message:</p> <pre><code>Sender:  \nSending Server IP:  \nReverse DNS:  \nSubject:  \nURL: hxxp://  \nDomain:  \nAttachment Name:  \nFile MD5 Hash:  \nFile SHA1 Hash:  \nFile SHA256 Hash:  \n</code></pre>"},{"location":"Email/phishing/#response","title":"Response","text":"<p>Email artefact blocking:  </p> <pre><code>- Subject line  \n- Sending address  \n- Sending server IP  \n</code></pre> <p>Web artefact blocking:</p> <pre><code>- URL  \n- Domain  \n- IP  \n</code></pre> <p>File artefact blocking:</p> <pre><code>- File name  \n- File hash\n</code></pre> <p>Tools:</p> <p>urlscan.io VirusTotal</p>"},{"location":"Email/spam/","title":"Spam","text":""},{"location":"Email/spoofing/","title":"Spoofing","text":""},{"location":"Malware/ransomware/","title":"Ransomware","text":""},{"location":"Malware/rootkits/","title":"Rootkits","text":""},{"location":"Malware/trojans/","title":"Trojans","text":""},{"location":"PUA/adware/","title":"Adware","text":""},{"location":"PUA/scareware/","title":"Scareware","text":""},{"location":"Sentinel/A%20user%20account%20compromised%20by%20a%20credential%20guessing%20or%20stuffing%20attack/","title":"A user account compromised by a credential guessing or stuffing attack","text":""},{"location":"Sentinel/A%20user%20account%20compromised%20by%20a%20credential%20guessing%20or%20stuffing%20attack/#a-user-account-compromised-by-a-credential-guessing-or-stuffing-attack","title":"A user account compromised by a credential guessing or stuffing attack","text":""},{"location":"Sentinel/A%20user%20account%20compromised%20by%20a%20credential%20guessing%20or%20stuffing%20attack/#single-line-description","title":"Single Line Description","text":"<p>The alert indicates that a user account has been compromised through a credential guessing or stuffing attack, involving an IP address and accessing Microsoft Azure.</p>"},{"location":"Sentinel/A%20user%20account%20compromised%20by%20a%20credential%20guessing%20or%20stuffing%20attack/#severity","title":"Severity","text":"<p>High: Indicates a potentially severe security breach due to successful credential-based attacks.</p>"},{"location":"Sentinel/A%20user%20account%20compromised%20by%20a%20credential%20guessing%20or%20stuffing%20attack/#detection","title":"Detection","text":"<p>Triggered by: Alert from Microsoft security products such as Sentinel, Defender for Endpoint, or Defender for Office 365.</p> <p>Alert name: \"User Account Compromised by Credential Guessing or Stuffing Attack\"</p> <p>Description: An alert triggered when a user account is accessed through credential guessing or stuffing attacks, impacting Microsoft Azure.</p>"},{"location":"Sentinel/A%20user%20account%20compromised%20by%20a%20credential%20guessing%20or%20stuffing%20attack/#collection","title":"Collection","text":"<p>Logs to be collected:    - Azure AD sign-in logs.    - Microsoft Sentinel incident details.    - Defender for Endpoint alerts and logs.    - Defender for Office 365 activity logs.</p> <p>Artifacts:    - Impacted user account details.    - Source IP address of the attack.    - Cloud application (Microsoft Azure) activity logs.    - Related security alerts and threat intelligence reports.</p>"},{"location":"Sentinel/A%20user%20account%20compromised%20by%20a%20credential%20guessing%20or%20stuffing%20attack/#analysis","title":"Analysis","text":"<ol> <li>Verify the Alert:</li> <li>Confirm the accuracy of the alert by reviewing sign-in logs and correlating with other security alerts.</li> <li> <p>Validate the source IP address against known malicious IP databases.</p> </li> <li> <p>Investigate User Activity:</p> </li> <li>Review recent activities of the impacted user account in Microsoft Azure.</li> <li> <p>Identify any anomalous or unauthorized activities performed post-compromise.</p> </li> <li> <p>Contextual Information:</p> </li> <li>Gather additional information about usual login patterns and geolocations of the user.</li> <li>Cross-reference the source IP address with threat intelligence to determine the nature of the attack.</li> </ol>"},{"location":"Sentinel/A%20user%20account%20compromised%20by%20a%20credential%20guessing%20or%20stuffing%20attack/#containment-and-eradication","title":"Containment and Eradication","text":"<ol> <li>Immediate Containment:</li> <li>Temporarily disable the compromised user account to prevent further unauthorized access.</li> <li> <p>Enforce a password reset for the affected user account across all Microsoft services.</p> </li> <li> <p>Eradication:</p> </li> <li>Block the malicious IP address on firewalls and endpoint protection solutions.</li> <li>Check for and remove any malware or backdoors if compromised devices are identified.</li> <li>Revoke any active sessions and tokens associated with the compromised account in Microsoft Azure.</li> </ol>"},{"location":"Sentinel/A%20user%20account%20compromised%20by%20a%20credential%20guessing%20or%20stuffing%20attack/#recovery","title":"Recovery","text":"<ol> <li>Restore Access:</li> <li>Re-enable the user account after ensuring it is secure.</li> <li>Ensure the user sets a strong, unique password and understands secure password practices.</li> <li> <p>Implement multi-factor authentication (MFA) for the user account if not already enabled.</p> </li> <li> <p>Monitor:</p> </li> <li>Increase monitoring of the user account for further suspicious activities.</li> <li> <p>Regularly review login attempts and access patterns to detect any future anomalies.</p> </li> <li> <p>Review and Update:</p> </li> <li>Review and update security policies, user education programs, and incident response procedures based on the incident.</li> <li>Enhance detection rules and preventive measures to avoid similar incidents in the future.</li> </ol>"},{"location":"Sentinel/A%20user%20account%20compromised%20by%20a%20credential%20guessing%20or%20stuffing%20attack/#approvals","title":"Approvals","text":"<p>Incident Commander: - Oversees the incident response process and approves containment and eradication measures.</p> <p>IT Security Manager: - Approves recovery steps and ensures that the system and network are secure before restoring access.</p> <p>Compliance Officer: - Reviews the incident for compliance-related implications and approves the final incident report.</p>"},{"location":"Sentinel/Staff%20login%20from%20different%20countries%20within%203%20hours/","title":"Staff login from different countries within 3 hours","text":""},{"location":"Sentinel/Staff%20login%20from%20different%20countries%20within%203%20hours/#staff-login-from-different-countries-within-3-hours","title":"Staff login from different countries within 3 hours","text":""},{"location":"Sentinel/Staff%20login%20from%20different%20countries%20within%203%20hours/#description","title":"Description","text":"<p>The KQL query identifies user accounts with successful logins from multiple distinct countries within a specified timeframe, excluding certain usernames and IP ranges.</p>"},{"location":"Sentinel/Staff%20login%20from%20different%20countries%20within%203%20hours/#severity","title":"Severity:","text":"<ul> <li>High: Indicates potential account compromise due to successful logins from multiple countries.</li> </ul>"},{"location":"Sentinel/Staff%20login%20from%20different%20countries%20within%203%20hours/#detection","title":"Detection:","text":"<ul> <li>Triggered by: Detection rule based on the provided KQL query.</li> <li>Alert name: \"Multiple Successful Logins from Different Countries\"</li> <li>Description: An alert triggered when a user account has successful logins from multiple distinct countries within the specified timeframe.</li> </ul>"},{"location":"Sentinel/Staff%20login%20from%20different%20countries%20within%203%20hours/#collection","title":"Collection:","text":"<ul> <li>Logs to be collected:</li> <li>Authentication logs (<code>imAuthentication</code>).</li> <li>Network logs, firewall logs, and VPN logs for additional context.</li> <li>Artifacts:</li> <li>Details of the successful logins, including timestamps, IP addresses, and geolocation data.</li> <li>User activity logs.</li> <li>Device and session information.</li> </ul>"},{"location":"Sentinel/Staff%20login%20from%20different%20countries%20within%203%20hours/#analysis","title":"Analysis:","text":"<ol> <li>Verify the Alert:</li> <li> <p>Confirm the accuracy by cross-referencing with raw log data and verifying distinct geolocations of logon attempts.</p> </li> <li> <p>Investigate User Activity:</p> </li> <li>Review recent activities of the affected user account for any unusual or unauthorized actions.</li> <li> <p>Examine the sequence of logons and actions taken by the user post-logon.</p> </li> <li> <p>Contextual Information:</p> </li> <li>Gather additional contextual information, such as usual login patterns of the user.</li> <li>Cross-reference source IP addresses with threat intelligence databases.</li> </ol>"},{"location":"Sentinel/Staff%20login%20from%20different%20countries%20within%203%20hours/#containment-and-eradication","title":"Containment and Eradication:","text":"<ol> <li>Immediate Containment:</li> <li>Temporarily disable the user account to prevent further unauthorized access.</li> <li> <p>Enforce a password reset for the affected user account.</p> </li> <li> <p>Eradication:</p> </li> <li>Block identified malicious IP addresses.</li> <li>Remove any malware or backdoors from compromised devices.</li> <li>Revoke suspicious sessions and tokens associated with the user account.</li> </ol>"},{"location":"Sentinel/Staff%20login%20from%20different%20countries%20within%203%20hours/#recovery","title":"Recovery:","text":"<ol> <li>Restore Access:</li> <li>Re-enable the user account after securing it.</li> <li>Ensure the user sets a strong, unique password.</li> <li> <p>Implement multi-factor authentication (MFA) if not already enabled.</p> </li> <li> <p>Monitor:</p> </li> <li>Increase monitoring of the user account for further suspicious activities.</li> <li> <p>Regularly review login attempts and geolocation data for anomalies.</p> </li> <li> <p>Review and Update:</p> </li> <li>Review and update security policies and incident response procedures based on the incident.</li> <li>Enhance detection rules and preventive measures to avoid similar incidents.</li> </ol>"},{"location":"Sentinel/Staff%20login%20from%20different%20countries%20within%203%20hours/#approvals","title":"Approvals:","text":"<ul> <li>Incident Commander:</li> <li> <p>Oversees the incident response process and approves containment and eradication measures.</p> </li> <li> <p>IT Security Manager:</p> </li> <li> <p>Approves recovery steps and ensures system and network security before restoring access.</p> </li> <li> <p>Compliance Officer:</p> </li> <li>Reviews the incident for compliance-related implications and approves the final incident report.</li> </ul>"},{"location":"Sentinel/template/","title":"Template","text":"<p>Severity:</p> <p>Detection:</p> <p>Collection:</p> <p>Analysis:</p> <p>Containment and Eradication:</p> <p>Recovery:</p> <p>Approvals:</p>"}]}